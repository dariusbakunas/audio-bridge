services:
  hub:
    build:
      context: .
      dockerfile: Dockerfile.server
    image: ${AUDIO_HUB_IMAGE:-audio-hub-server:local}
    user: "${AUDIO_HUB_UID:-1000}:${AUDIO_HUB_GID:-1000}"
    network_mode: host
    environment:
      # Optional runtime override for the web UI API base URL.
      # Example: http://host.docker.internal:8080
      - AUDIO_HUB_WEB_API_BASE=${AUDIO_HUB_WEB_API_BASE:-}
    volumes:
      - ./crates/audio-hub-server/config.example.toml:/config/config.toml
      - ${AUDIO_HUB_MEDIA_DIR:-./music}:/music
      - ${AUDIO_HUB_DATA_DIR:-./data}:/data
    command:
      - --bind
      - 0.0.0.0:8080
      - --config
      - /config/config.toml
      - --metadata-db-path
      - /data/metadata.sqlite
    restart: unless-stopped
